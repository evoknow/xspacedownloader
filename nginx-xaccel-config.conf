# Nginx configuration for X-Accel-Redirect audio streaming
# This configuration should be added to your existing Nginx server block

# Internal location for serving audio/video files directly by Nginx
# This handles byte-range requests and HTTP/2 framing properly
location /downloads/ {
    internal;  # This location can only be accessed via X-Accel-Redirect
    
    # Update this path to match your actual downloads directory
    alias /var/www/production/xspacedownload.com/website/htdocs/downloads/;
    
    # Optimize file serving
    sendfile on;
    tcp_nopush on;
    tcp_nodelay on;
    
    # Disable gzip for media files (already compressed)
    gzip off;
    
    # Enable byte-range support
    add_header Accept-Ranges bytes;
    
    # Set proper MIME types for media files
    types {
        audio/mpeg mp3;
        audio/mp4 m4a;
        audio/wav wav;
        audio/ogg ogg;
        audio/flac flac;
        video/mp4 mp4;
    }
    default_type application/octet-stream;
    
    # Optional: Add cache headers for better performance
    add_header Cache-Control "public, max-age=3600";
    
    # Optional: CORS headers if needed
    add_header Access-Control-Allow-Origin "*";
    add_header Access-Control-Allow-Methods "GET, HEAD, OPTIONS";
    add_header Access-Control-Allow-Headers "Range";
}

# Note: Remove any existing /download/ proxy configuration that might conflict
# The Flask app will now use X-Accel-Redirect to serve files through this internal location